inputs:
  node-version:
    description: 'Node.js version'
    required: true

runs:
  using: 'composite'
  steps:
  - name: Use Node.js ${{ inputs.node-version }}
    uses: actions/setup-node@v1
    with:
      node-version: ${{ inputs.node-version }}

  - name: Cache node_modules (Linux)
    if: runner.os == 'Linux'
    uses: actions/cache@v2
    with:
      path: ~/.npm
      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
      restore-keys: |
        ${{ runner.os }}-node-
        ${{ runner.os }}-

  - name: Cache node_modules 1/2 (Windows)
    if: runner.os == 'Windows'
    id: npm-cache
    run: |
      echo "::set-output name=dir::$(npm config get cache)"
  - name: Cache node_modules 2/2 (Windows)
    uses: actions/cache@v2
    if: runner.os == 'Windows'
    with:
      path: ${{ steps.npm-cache.outputs.dir }}
      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
      restore-keys: |
        ${{ runner.os }}-node-
        ${{ runner.os }}-

  - name: Install Node Modules
    run: npm ci
